<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DashControl Business - Dados</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; font-family:'Poppins', sans-serif; background:#0d0d0d; color:white; }
    header { background:linear-gradient(90deg,#8e44ad,#b8860b); padding:15px; font-size:22px; font-weight:700; text-align:center; }
    h2 { color:#d4af37; margin:20px 0; text-align:center; }
    section { background:#1a1a1a; padding:20px; margin:20px auto; border-radius:12px; max-width:900px; box-shadow:0 4px 20px rgba(0,0,0,0.6); }
    label { display:block; margin:10px 0 5px; font-weight:600; color:#d4af37; }
    input, select { padding:10px; border-radius:6px; border:none; width:100%; background:#2c2c2c; color:white; font-size:14px; }
    .actions { text-align:center; margin-top:15px; }
    button { background:#8e44ad; padding:12px 20px; margin:8px; border:none; border-radius:8px; color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
    button:hover { background:#b8860b; transform:scale(1.05); }
    .hidden { display:none; }
  </style>
</head>
<body>

<header>⚙️ DashControl Business - Inserção de Dados</header>

<!-- Registro de Venda -->
<section>
  <h2>🛒 Registrar Venda</h2>
  <label>Produto/Serviço:</label>
  <input type="text" id="vendaProduto">

  <label>Valor (R$):</label>
  <input type="number" id="vendaValor">

  <label>Forma de Pagamento:</label>
  <select id="vendaPagamento" onchange="toggleTroco()">
    <option value="Pix">⚡ Pix</option>
    <option value="Débito">💳 Débito</option>
    <option value="Crédito">💳 Crédito</option>
    <option value="Dinheiro">💵 Dinheiro</option>
  </select>

  <div id="trocoArea" class="hidden">
    <label>Valor Recebido (R$):</label>
    <input type="number" id="valorRecebido">
  </div>

  <label>Data da Venda:</label>
  <input type="date" id="vendaData" />

  <div class="actions">
    <button onclick="registrarVenda()">💾 Registrar Venda</button>
  </div>
</section>

<!-- Cadastro de Produtos -->
<section>
  <h2>📦 Cadastro de Produtos/Serviços</h2>
  <label>Nome:</label>
  <input type="text" id="estoqueNome">

  <label>Valor Unitário (R$):</label>
  <input type="number" id="estoqueValor">

  <label>Quantidade (deixe vazio se for serviço):</label>
  <input type="number" id="estoqueQtd">

  <div class="actions">
    <button onclick="adicionarEstoque()">➕ Adicionar</button>
  </div>
</section>

<!-- Financeiro -->
<section>
  <h2>💰 Financeiro</h2>
  <label>Caixa Inicial (R$):</label>
  <input type="number" id="caixaInicial">

  <div class="actions">
    <button onclick="definirCaixa()">💾 Definir Caixa Inicial</button>
  </div>
</section>

<script type="module">
  import { db } from "./firebase.js";
  import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  function toggleTroco() {
    let pagamento = document.getElementById("vendaPagamento").value;
    document.getElementById("trocoArea").classList.toggle("hidden", pagamento !== "Dinheiro");
  }

  // ➕ Adicionar Produto ao Estoque
  async function adicionarEstoque() {
    let nome = document.getElementById("estoqueNome").value.trim();
    let valor = parseFloat(document.getElementById("estoqueValor").value) || 0;
    let qtdInput = document.getElementById("estoqueQtd").value;
    let quantidade = qtdInput === "" ? null : parseInt(qtdInput);

    if (!nome || valor <= 0) { alert("⚠️ Preencha nome e valor válidos!"); return; }

    await addDoc(collection(db, "estoque"), {
      nome, valor, quantidade, criadoEm: new Date().toISOString()
    });

    alert("✅ Produto adicionado!");
    document.getElementById("estoqueNome").value="";
    document.getElementById("estoqueValor").value="";
    document.getElementById("estoqueQtd").value="";
  }

  // 💾 Registrar Venda
  async function registrarVenda() {
    let produto = document.getElementById("vendaProduto").value.trim();
    let valor = parseFloat(document.getElementById("vendaValor").value) || 0;
    let pagamento = document.getElementById("vendaPagamento").value;
    let data = document.getElementById("vendaData").value || new Date().toISOString().split("T")[0];

    if (!produto || valor <= 0) { alert("⚠️ Preencha os campos da venda!"); return; }

    let recebido = parseFloat(document.getElementById("valorRecebido").value) || valor;
    let troco = pagamento === "Dinheiro" ? (recebido - valor) : 0;
    if (pagamento === "Dinheiro" && recebido < valor) { alert("⚠️ Valor recebido insuficiente!"); return; }

    await addDoc(collection(db, "vendas"), {
      prodId: produto, valor, pagamento, troco, data, criadoEm: new Date().toISOString()
    });

    await addDoc(collection(db, "financeiro"), {
      entrada: valor, saida: troco, data, criadoEm: new Date().toISOString()
    });

    alert("✅ Venda registrada!");
    document.getElementById("vendaProduto").value="";
    document.getElementById("vendaValor").value="";
    document.getElementById("valorRecebido").value="";
  }

  // 💰 Definir Caixa Inicial
  async function definirCaixa() {
    let inicial = parseFloat(document.getElementById("caixaInicial").value) || 0;
    if (inicial < 0) { alert("⚠️ Valor inválido!"); return; }

    await addDoc(collection(db, "financeiro"), {
      entrada: inicial, saida: 0, data: new Date().toISOString().split("T")[0], criadoEm: new Date().toISOString()
    });

    alert("✅ Caixa inicial definido!");
    document.getElementById("caixaInicial").value="";
  }
</script>

</body>
</html>