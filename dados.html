<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DashControl Business - Dados (LocalStorage)</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; font-family:'Poppins', sans-serif; background:#0d0d0d; color:white; }
    header { background:linear-gradient(90deg,#8e44ad,#b8860b); padding:15px; font-size:22px; font-weight:700; text-align:center; }
    h2 { color:#d4af37; margin:20px 0; text-align:center; }
    section { background:#1a1a1a; padding:20px; margin:20px auto; border-radius:12px; max-width:900px; box-shadow:0 4px 20px rgba(0,0,0,0.6); }
    label { display:block; margin:10px 0 5px; font-weight:600; color:#d4af37; }
    input, select { padding:10px; border-radius:6px; border:none; width:100%; background:#2c2c2c; color:white; font-size:14px; }
    .actions { text-align:center; margin-top:15px; }
    button.btn { background:#8e44ad; padding:12px 20px; margin:8px; border:none; border-radius:8px; color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
    button.btn:hover { background:#b8860b; transform:scale(1.05); }
    .row { display:flex; flex-wrap:wrap; gap:15px; }
    .col { flex:1; min-width:200px; }
    .hidden { display:none; }
    .list-item { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid #2c2c2c; }
    .list-item:last-child { border-bottom: none; }
    .list-container { margin-top:15px; padding:10px; background:#2c2c2c; border-radius:8px; }
  </style>
</head>
<body>

<header>‚öôÔ∏è DashControl Business - Inser√ß√£o de Dados</header>

<section id="secVenda">
  <h2>üõí Registrar Venda</h2>
  <label>Produto/Servi√ßo:</label>
  <select id="vendaProduto"></select>

  <label>Valor (R$):</label>
  <input type="number" id="vendaValor" readonly>

  <label>Forma de Pagamento:</label>
  <select id="vendaPagamento" onchange="toggleTroco()">
    <option value="Pix">‚ö° Pix</option>
    <option value="D√©bito">üí≥ D√©bito</option>
    <option value="Cr√©dito">üí≥ Cr√©dito</option>
    <option value="Dinheiro">üíµ Dinheiro</option>
  </select>

  <div id="trocoArea" class="hidden">
    <label>Valor Recebido (R$):</label>
    <input type="number" id="valorRecebido">
  </div>

  <label>Data da Venda:</label>
  <input type="date" id="vendaData" />

  <div class="actions">
    <button class="btn" type="button" onclick="appState.registrarVenda()">üíæ Registrar Venda</button>
  </div>
</section>

<section>
  <h2>üì¶ Cadastro de Produtos/Servi√ßos</h2>
  <label>Nome:</label>
  <input type="text" id="estoqueNome">

  <label>Valor Unit√°rio (R$):</label>
  <input type="number" id="estoqueValor">

  <label>Quantidade (deixe vazio se for servi√ßo):</label>
  <input type="number" id="estoqueQtd">

  <div class="actions">
    <button class="btn" type="button" onclick="appState.adicionarEstoque()">‚ûï Adicionar</button>
  </div>
  
  <div class="list-container">
    <h3>Itens Cadastrados:</h3>
    <div id="listaEstoque"></div>
  </div>
</section>

<section>
  <h2>üí∞ Financeiro</h2>
  <label>Caixa Inicial (R$):</label>
  <input type="number" id="caixaInicial">

  <div class="actions">
    <button class="btn" type="button" onclick="appState.definirCaixa()">üíæ Definir Caixa Inicial</button>
  </div>

  <div class="row">
    <div class="col"><strong>Entradas:</strong> R$ <span id="finEntradas">0.00</span></div>
    <div class="col"><strong>Sa√≠das:</strong> R$ <span id="finSaidas">0.00</span></div>
    <div class="col"><strong>Saldo:</strong> R$ <span id="finSaldo">0.00</span></div>
  </div>
</section>

<section>
  <h2>üìä Relat√≥rios</h2>
  <label>Filtrar por data:</label>
  <input type="date" id="filtroDataRelatorio">
  <div class="actions">
    <button class="btn" type="button" onclick="appState.gerarRelatorio()">Gerar Relat√≥rio</button>
  </div>
  <div id="relatorioResultado" class="list-container"></div>
</section>

<script>
const appState = {
  data: { vendas: [], estoque: [], financeiro: [] },

  load() {
    this.data = JSON.parse(localStorage.getItem("dashBusiness")) || { vendas: [], estoque: [], financeiro: [] };
  },

  save() {
    localStorage.setItem("dashBusiness", JSON.stringify(this.data));
    this.updateUI();
  },
  
  updateUI() {
    this.atualizarSelect();
    this.atualizarEstoqueUI();
    this.atualizarFinanceiroUI();
  },

  atualizarValorVenda() {
    const i = document.getElementById("vendaProduto").value;
    if (i !== "") {
      document.getElementById("vendaValor").value = this.data.estoque[i].valor.toFixed(2);
    }
  },

  atualizarSelect() {
    const sel = document.getElementById("vendaProduto");
    sel.innerHTML = "";
    this.data.estoque.forEach((p, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.text = `${p.nome} - R$${p.valor.toFixed(2)}` + (p.quantidade !== null ? ` (Qtd: ${p.quantidade})` : ` (Servi√ßo)`);
      sel.appendChild(opt);
    });
    if (this.data.estoque.length > 0) {
      this.atualizarValorVenda();
    } else {
      document.getElementById("vendaValor").value = "";
    }
  },

  atualizarEstoqueUI() {
    const lista = document.getElementById("listaEstoque");
    lista.innerHTML = "";
    if (this.data.estoque.length === 0) {
      lista.innerHTML = "<p style='text-align:center;'>Nenhum item cadastrado.</p>";
      return;
    }
    this.data.estoque.forEach((item, index) => {
      const div = document.createElement("div");
      div.className = "list-item";
      div.innerHTML = `
        <span>${item.nome} - R$${item.valor.toFixed(2)} (${item.quantidade !== null ? `Qtd: ${item.quantidade}` : 'Servi√ßo'})</span>
        <button class="btn" type="button" onclick="appState.removerItem('estoque', ${index})">Remover</button>
      `;
      lista.appendChild(div);
    });
  },

  atualizarFinanceiroUI() {
    const entradas = this.data.financeiro.reduce((s, f) => s + (f.entrada || 0), 0);
    const saidas = this.data.financeiro.reduce((s, f) => s + (f.saida || 0), 0);
    const saldo = entradas - saidas;
    
    document.getElementById("finEntradas").innerText = entradas.toFixed(2);
    document.getElementById("finSaidas").innerText = saidas.toFixed(2);
    document.getElementById("finSaldo").innerText = saldo.toFixed(2);
  },

  removerItem(categoria, index) {
    if (confirm(`Tem certeza que deseja remover este item?`)) {
      this.data[categoria].splice(index, 1);
      this.save();
    }
  },

  registrarVenda() {
    const i = document.getElementById("vendaProduto").value;
    if (i === "") { alert("‚ö†Ô∏è Selecione um produto!"); return; }
    
    const produto = this.data.estoque[i];
    const valor = parseFloat(document.getElementById("vendaValor").value) || 0;
    const pagamento = document.getElementById("vendaPagamento").value;
    const data = document.getElementById("vendaData").value || new Date().toISOString().split('T')[0];

    if (valor <= 0) { alert("‚ö†Ô∏è O valor da venda deve ser maior que zero!"); return; }
    
    let troco = 0;
    if (pagamento === "Dinheiro") {
      const recebido = parseFloat(document.getElementById("valorRecebido").value) || 0;
      if (recebido < valor) { alert("‚ö†Ô∏è Valor recebido insuficiente!"); return; }
      troco = recebido - valor;
    }

    if (produto.quantidade !== null && produto.quantidade <= 0) {
      alert("‚ö†Ô∏è Produto fora de estoque!");
      return;
    }

    if (produto.quantidade !== null) {
      produto.quantidade--;
    }

    this.data.vendas.push({ produto: produto.nome, valor, pagamento, troco, data });
    this.data.financeiro.push({ entrada: valor, saida: troco, data });

    this.save();
    alert("‚úÖ Venda registrada!");
    document.getElementById("valorRecebido").value = "";
    document.getElementById("relatorioResultado").innerHTML = "";
  },

  adicionarEstoque() {
    const nome = document.getElementById("estoqueNome").value.trim();
    const valor = parseFloat(document.getElementById("estoqueValor").value);
    const qtdInput = document.getElementById("estoqueQtd").value;
    
    if (!nome || isNaN(valor) || valor < 0) {
      alert("‚ö†Ô∏è Preencha nome e valor unit√°rio com valores v√°lidos!");
      return;
    }
    const quantidade = qtdInput === "" ? null : parseInt(qtdInput);
    if (quantidade !== null && (isNaN(quantidade) || quantidade < 0)) {
      alert("‚ö†Ô∏è A quantidade deve ser um n√∫mero inteiro e n√£o negativo!");
      return;
    }

    this.data.estoque.push({ nome, valor, quantidade });
    this.save();

    document.getElementById("estoqueNome").value = "";
    document.getElementById("estoqueValor").value = "";
    document.getElementById("estoqueQtd").value = "";

    alert("‚úÖ Produto/Servi√ßo cadastrado!");
  },

  definirCaixa() {
    const inicial = parseFloat(document.getElementById("caixaInicial").value) || 0;
    if (isNaN(inicial) || inicial < 0) {
      alert("‚ö†Ô∏è O valor inicial deve ser um n√∫mero v√°lido e n√£o negativo!");
      return;
    }
    
    this.data.financeiro = [];
    this.data.financeiro.push({ entrada: inicial, saida: 0, data: new Date().toISOString().split('T')[0] });
    this.save();
    
    alert("‚úÖ Caixa inicial definido!");
  },

  gerarRelatorio() {
    const dataFiltro = document.getElementById("filtroDataRelatorio").value;
    const vendasFiltradas = this.data.vendas.filter(venda => venda.data === dataFiltro);
    const resultado = document.getElementById("relatorioResultado");
    resultado.innerHTML = "";

    if (!dataFiltro) {
      resultado.innerHTML = "<p style='text-align:center;'>Selecione uma data para gerar o relat√≥rio.</p>";
      return;
    }

    if (vendasFiltradas.length === 0) {
      resultado.innerHTML = "<p style='text-align:center;'>Nenhuma venda encontrada para a data selecionada.</p>";
      return;
    }

    let totalVendas = 0;
    vendasFiltradas.forEach(v => totalVendas += v.valor);

    const relatorioHTML = `
      <h3>Resumo do dia ${dataFiltro}</h3>
      <p><strong>Total de Vendas:</strong> R$${totalVendas.toFixed(2)}</p>
      <p><strong>N√∫mero de Vendas:</strong> ${vendasFiltradas.length}</p>
      <h4>Detalhes das Vendas:</h4>
      ${vendasFiltradas.map(venda => `
        <div class="list-item">
          <span>${venda.produto} - R$${venda.valor.toFixed(2)} (${venda.pagamento})</span>
        </div>
      `).join('')}
    `;
    resultado.innerHTML = relatorioHTML;
  },

  init() {
    this.load();
    document.getElementById("vendaData").value = new Date().toISOString().split("T")[0];
    this.updateUI();
    document.getElementById("vendaProduto").addEventListener("change", this.atualizarValorVenda.bind(this));
    document.getElementById("vendaPagamento").addEventListener("change", toggleTroco);
  }
};

function toggleTroco() {
  const pagamento = document.getElementById("vendaPagamento").value;
  document.getElementById("trocoArea").classList.toggle("hidden", pagamento !== "Dinheiro");
}

window.onload = () => {
  appState.init();
};
</script>

</body>
</html>
