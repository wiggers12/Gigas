<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DashControl Business - Dados</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; font-family:'Poppins', sans-serif; background:#0d0d0d; color:white; }
    header { background:linear-gradient(90deg,#8e44ad,#b8860b); padding:15px; font-size:22px; font-weight:700; text-align:center; }
    h2 { color:#d4af37; margin:20px 0; text-align:center; }
    section { background:#1a1a1a; padding:20px; margin:20px auto; border-radius:12px; max-width:900px; box-shadow:0 4px 20px rgba(0,0,0,0.6); }
    label { display:block; margin:10px 0 5px; font-weight:600; color:#d4af37; }
    input, select { padding:10px; border-radius:6px; border:none; width:100%; background:#2c2c2c; color:white; font-size:14px; }
    .actions { text-align:center; margin-top:15px; }
    button { background:#8e44ad; padding:12px 20px; margin:8px; border:none; border-radius:8px; color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
    button:hover { background:#b8860b; transform:scale(1.05); }
    .row { display:flex; flex-wrap:wrap; gap:15px; }
    .col { flex:1; min-width:200px; }
    .hidden { display:none; }
  </style>
</head>
<body>

<header>‚öôÔ∏è DashControl Business - Inser√ß√£o de Dados</header>

<!-- Sess√£o Vendas -->
<section id="secVenda">
  <h2>üõí Registrar Venda</h2>
  <label>Produto/Servi√ßo:</label>
  <select id="vendaProduto"></select>

  <label>Valor (R$):</label>
  <input type="number" id="vendaValor" readonly>

  <label>Forma de Pagamento:</label>
  <select id="vendaPagamento" onchange="toggleTroco()">
    <option value="Pix">‚ö° Pix</option>
    <option value="D√©bito">üí≥ D√©bito</option>
    <option value="Cr√©dito">üí≥ Cr√©dito</option>
    <option value="Dinheiro">üíµ Dinheiro</option>
  </select>

  <div id="trocoArea" class="hidden">
    <label>Valor Recebido (R$):</label>
    <input type="number" id="valorRecebido">
  </div>

  <label>Data da Venda:</label>
  <input type="date" id="vendaData" value="" />

  <div class="actions">
    <button onclick="registrarVenda()">üíæ Registrar Venda</button>
  </div>
</section>

<!-- Sess√£o Estoque/Servi√ßos -->
<section>
  <h2>üì¶ Cadastro de Produtos/Servi√ßos</h2>
  <label>Nome:</label>
  <input type="text" id="estoqueNome">

  <label>Valor Unit√°rio (R$):</label>
  <input type="number" id="estoqueValor">

  <label>Quantidade (deixe vazio se for servi√ßo):</label>
  <input type="number" id="estoqueQtd">

  <div class="actions">
    <button onclick="adicionarEstoque()">‚ûï Adicionar</button>
  </div>
</section>

<!-- Sess√£o Financeiro -->
<section>
  <h2>üí∞ Financeiro</h2>
  <label>Caixa Inicial (R$):</label>
  <input type="number" id="caixaInicial">

  <div class="actions">
    <button onclick="definirCaixa()">üíæ Definir Caixa Inicial</button>
  </div>

  <div class="row">
    <div class="col"><strong>Entradas:</strong> <span id="finEntradas">0</span></div>
    <div class="col"><strong>Sa√≠das:</strong> <span id="finSaidas">0</span></div>
    <div class="col"><strong>Saldo:</strong> <span id="finSaldo">0</span></div>
  </div>
</section>

<script>
let dados = JSON.parse(localStorage.getItem("dashBusiness")) || {vendas:[], estoque:[], financeiro:[]};

// Preenche select de produtos
function atualizarSelect(){
  let sel=document.getElementById("vendaProduto");
  sel.innerHTML="";
  dados.estoque.forEach((p,i)=>{
    let opt=document.createElement("option");
    opt.value=i;
    opt.text=`${p.nome} - R$${p.valor}`;
    sel.appendChild(opt);
  });
  if(dados.estoque.length>0) atualizarValorVenda();
}

// Atualiza valor ao trocar produto
function atualizarValorVenda(){
  let i=document.getElementById("vendaProduto").value;
  if(i!=="") document.getElementById("vendaValor").value=dados.estoque[i].valor;
}
document.getElementById("vendaProduto").addEventListener("change", atualizarValorVenda);

// Exibir campo troco
function toggleTroco(){
  let pagamento=document.getElementById("vendaPagamento").value;
  document.getElementById("trocoArea").classList.toggle("hidden", pagamento!=="Dinheiro");
}

// Registrar venda
function registrarVenda(){
  let i=document.getElementById("vendaProduto").value;
  if(i===""){ alert("Selecione um produto!"); return; }
  let produto=dados.estoque[i];
  let valor=parseFloat(document.getElementById("vendaValor").value)||0;
  let pagamento=document.getElementById("vendaPagamento").value;
  let data=document.getElementById("vendaData").value || new Date().toLocaleDateString();

  let troco=0;
  if(pagamento==="Dinheiro"){
    let recebido=parseFloat(document.getElementById("valorRecebido").value)||0;
    if(recebido<valor){ alert("Valor recebido insuficiente!"); return; }
    troco=recebido-valor;
  }

  // baixa estoque se for produto
  if(produto.quantidade !== null && produto.quantidade > 0){ 
    produto.quantidade--; 
  }

  // salvar venda
  let venda={tipo:"venda", produto:produto.nome, valor, pagamento, troco, data};
  dados.vendas.push(venda);

  // atualizar financeiro
  let entradas=valor;
  let saidas=troco;
  let saldoAtual=(dados.financeiro.length?dados.financeiro[dados.financeiro.length-1].saldo:0)+entradas-saidas;
  dados.financeiro.push({tipo:"financeiro", entrada:entradas, saida:saidas, saldo:saldoAtual, data});

  salvar();
  alert("‚úÖ Venda registrada!");

  // limpar campos
  document.getElementById("valorRecebido").value="";
}

// Adicionar estoque
function adicionarEstoque(){
  let nome=document.getElementById("estoqueNome").value;
  let valor=parseFloat(document.getElementById("estoqueValor").value)||0;
  let quantidade=parseInt(document.getElementById("estoqueQtd").value);
  if(!nome||!valor){ alert("Preencha nome e valor!"); return; }

  if(isNaN(quantidade)) quantidade = null; // servi√ßo

  dados.estoque.push({nome,valor,quantidade});
  salvar();

  // limpa formul√°rio
  document.getElementById("estoqueNome").value="";
  document.getElementById("estoqueValor").value="";
  document.getElementById("estoqueQtd").value="";

  atualizarSelect();
  alert("‚úÖ Produto/Servi√ßo cadastrado!");
}

// Definir caixa inicial
function definirCaixa(){
  let inicial=parseFloat(document.getElementById("caixaInicial").value)||0;
  let registro={tipo:"financeiro", entrada:inicial, saida:0, saldo:inicial, data:new Date().toLocaleDateString()};
  dados.financeiro.push(registro);
  salvar();
  atualizarFinanceiroUI();
  alert("‚úÖ Caixa inicial definido!");
}

// Atualizar UI financeiro
function atualizarFinanceiroUI(){
  let entradas=dados.financeiro.reduce((s,f)=>s+(f.entrada||0),0);
  let saidas=dados.financeiro.reduce((s,f)=>s+(f.saida||0),0);
  let saldo=dados.financeiro.length?dados.financeiro[dados.financeiro.length-1].saldo:0;
  document.getElementById("finEntradas").innerText=entradas;
  document.getElementById("finSaidas").innerText=saidas;
  document.getElementById("finSaldo").innerText=saldo;
}

// Salvar localStorage
function salvar(){ 
  localStorage.setItem("dashBusiness", JSON.stringify(dados)); 
  atualizarFinanceiroUI(); 
  atualizarSelect(); 
}

// Inicializa√ß√£o
window.onload=()=>{
  document.getElementById("vendaData").value=new Date().toISOString().split("T")[0];
  atualizarSelect();
  atualizarFinanceiroUI();
};
</script>

</body>
</html>